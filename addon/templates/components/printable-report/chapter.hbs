{{#each this.pages as |page pageIndexInChapter|}}
  {{#printable-report/page
    pageIndexInChapter=pageIndexInChapter
    registerSection=(action this.registerSection this.elementId)
    renderNextItem=(action 'renderNextItem' pageIndexInChapter)
    onPageOverflow=(action 'onPageOverflow' pageIndexInChapter)
    as |pageComponent|
  }}

    {{#if (and (eq pageComponent.block 'header') (eq pageIndexInChapter 0))}}
      <h2>Chapter {{inc this.chapter.index}} - {{this.elementId}}</h2>
    {{/if}}

    {{! TODO
      need to improve handling of block.
      instead of if, pass a 'shouldRender' flag into
      section, header, footer... and conditionally render them
    }}
    {{#if (eq pageComponent.block 'body')}}
      {{yield (hash
        number=(hash
          current=page.number
          total=@lastReportPage
          isFirst=(eq page.number 1)
          isFirstInChapter=(eq page.number this.startPage)
          isLast=(eq page.number @lastReportPage)
          isLastInChapter=(eq page.number this.endPage)
        )

        section=(component 'printable-report/section'
          sectionMap=this.chapter.sectionMap
          pageIndexInChapter=pageIndexInChapter
          pageElement=pageComponent.element

          register=(action pageComponent.registerSection)
          onSectionOverflow=pageComponent.onSectionOverflow
        )
      )}}
    {{/if}}
  {{/printable-report/page}}
{{/each}}
